# 【提案書】訪問ルート最適化システム 本番環境スケールアップのご提案

## 1. 提案の要旨（エグゼクティブサマリー）
現在、ReservaとGoogleカレンダー、そしてGASを組み合わせたシステムは、初期フェーズの運用において効率的に機能しています。
しかし、スタッフ数が数十名規模となり、将来的なプラットフォーム化（外販）も見据えると、GASの実行制限やMaps APIのコスト構造、そして**「セキュリティ・データ管理」**の面で事業拡大の課題となってきます。

本提案では、**「Reserva連携の利便性」は維持しつつ**、処理エンジンを**「APIコストを最小化」し「堅牢でセキュアな」**クラウド基盤（SaaS型アーキテクチャ）へ刷新するプランをご提示します。

## 2. なぜ今、投資が必要なのか？（現状のリスク）
現在のGoogle Apps Script (GAS) ベースのシステムには、事業規模が大きくなるにつれて顕在化する、以下の構造的リスクがあります。

*   **🔓 セキュリティと予期せぬデータ事故のリスク**
    *   **個人アカウントへの依存（事業継続リスク）**:
        システム全体が特定のGoogleアカウント（個人のDrive等）に強く紐付いています。もしアカウント凍結や、担当者の不在が発生した場合、**システム全体が即座に停止し、誰も復旧できなくなる**という「単一障害点」を抱えています。
    *   **データの脆さ（消失リスク）**:
        顧客住所（CSV）やスタッフ名簿（スプレッドシート）が、容易に編集・削除できる状態で置かれています。「操作ミスで行ごと削除してしまった」「上書きしてしまった」といった事故を防ぐ手立てがなく、データの安全性が担保されていません。
    *   **操作ログが残らない**:
        「誰が・いつ・どの顧客住所データを・閲覧/編集したか」という監査ログが残りません。個人情報を扱うシステムとして、将来的なコンプライアンス上の懸念となります。

*   **💰 Google Maps API コストの肥大化**
    *   現状の都度計算ロジックでは、スタッフが動くたびにAPI課金が発生するため、人数が増えるとコストが指数関数的に増加する構造になっています。

*   **🚨 「6分の壁」による業務停止リスク**
    *   GASの「実行時間6分制限」により、計算量が増えると処理が途中で強制終了され、「朝、ルート通知が届かない」という業務事故に直結します。

## 3. 本番環境（プロフェッショナル版）へ移行する解決策

### 🛡 1. セキュリティと事業継続性の確立
システム基盤を、個人アカウント環境から**弊社が運用・管理する商用クラウド基盤（SaaSモデル）**へと移行します。

*   **個人依存（単一障害点）の完全解消**:
    インフラ管理は全て専門チームが行うため、社内の担当者変更やアカウントトラブルに左右されず、**「止まらない」安定稼働**を保証します。
*   **堅牢なデータ管理**:
    重要な顧客・スタッフデータは、操作ミスで消えることのない**専用データベース（Google Cloud SQL等）**へ格納します。厳格なアクセス権限管理と自動バックアップにより、データの消失・漏洩リスクを最小化します。
*   **監査ログの全記録**:
    システム上の全ての操作を記録・保存し、「いつ・誰が・何をしたか」を後から確実に追跡できる体制を整えます。

### � 2. Google Maps API コストの最適化
**「スマート・キャッシュ戦略」**を導入し、コストを大幅に圧縮します。
一度取得した「地点間の距離・時間データ」をデータベースに**恒久的に保存**することで、定期訪問や同一エリア内の移動において**2回目以降のAPI利用料を0円**にします。

### 🚀 3. 通知機能の確実性と処理能力の強化
GASの時間制限がない高性能サーバー(Cloud Run)を採用し、以下の機能を実現します。
*   **自動リトライ（再送）機能**: 通信エラー等で通知が失敗しても、システムが自動検知して再送し、「届いていない」を防ぎます。
*   **流量制御**: LINE WORKSへの一斉送信ペースを自動調整し、APIブロックを回避します。

## 4. システム構成案（Before / After）

| 項目 | 今の状態 (Before) | 新しい状態 (After) |
|---|---|---|
| **安全性・管理**<br>(Security) | 個人アカウントに依存。<br>操作ログがなく、誤削除リスクが高い。 | **SaaS型クラウド基盤**。<br>弊社による24時間365日の安定稼働と、厳格なデータ保護・ログ管理。 |
| **予約入力** | Reserva ➡ Googleカレンダーへ同期。<br>（現状運用維持） | **Reserva ➡ Googleカレンダー**。<br>既存のReserva運用フローは変更不要です。 |
| **データ連携** | GASトリガーによる都度/定期実行。<br>複雑な処理に限界がある。 | **クラウドサーバーによる定期同期**。<br>データを専用DBへ構造化して保存し、高速な検索・分析を実現します。 |
| **ルート計算費用** | 都度APIコールによりコスト増のリスク。 | **「キャッシュDB」**活用。<br>既知ルートはAPI不使用で計算し、**コストを最小化**。 |
| **拡張性** | 単一組織向けの設計。 | **マルチテナント対応**。<br>将来のSaaS展開を見据えたスケーラブルな設計。 |

## 5. 将来的なSaaS事業化（プラットフォーム化）への備え
現在は御社単独でのご利用ですが、将来的な他社へのサービス提供（マルチテナント）を見据え、今回の刷新で「複数の会社が安全に同居できる設計」を採用します。
これにより、将来外販を開始する際、ゼロから開発し直すことなくスムーズに事業展開が可能となります。

## 6. ロードマップと投資計画（案）

### Phase 1: コア・エンジン刷新（約2.0ヶ月）
**目的**: 「セキュリティ強化」「APIコスト削減」「処理安定化」
*   セキュアなクラウドデータベースの構築とデータ移行
*   Maps APIキャッシュエンジンの実装
*   GASからの完全脱却（Cloud Runへの移行）
*   LINE WORKS通知基盤の強化
*   **投資概算**: 175〜200万円（税抜）

### Phase 2: プラットフォーム化・高度機能（Phase 1完了後〜）
**目的**: 他社展開・さらなる付加価値
*   マルチテナント管理機能（企業アカウント発行・管理画面）
*   リアルタイム動態管理（位置情報の可視化）
*   **投資概算**: 要件に応じて別途見積もり

---

## 7. (補足) 用語解説

*   **単一障害点 (SPOF)**:
    そこが壊れたらシステム全体が止まってしまう弱点のこと。個人のGoogleアカウントなどは典型的なSPOFであり、プロフェッショナルなシステムではこれを排除する設計が必須となります。
*   **Distance Matrix API のキャッシュ**:
    Google Mapsの距離・時間計算結果を保存し、再利用する仕組みです。「A地点からB地点」の物理的な距離は変化しないため、一度取得したデータを使い回すことで、高額になりがちなAPI通信費を大幅に削減します。
